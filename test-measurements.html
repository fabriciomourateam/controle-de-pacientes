<!DOCTYPE html>
<html>
<head>
    <title>Teste de Extração de Medidas</title>
</head>
<body>
    <h1>Teste de Extração de Medidas</h1>
    <div id="results"></div>

    <script>
        // Função de teste (cópia da função do measurement-utils.ts)
        function extractMeasurements(text) {
            if (!text) return { cintura: null, quadril: null };
            
            const textStr = text.toString();
            
            let cintura = null;
            let quadril = null;
            
            // Função para validar medidas
            function isValidMeasurement(value, type) {
                if (type === 'cintura') {
                    return value >= 50 && value <= 120;
                } else {
                    return value >= 70 && value <= 150;
                }
            }
            
            // Padrão 1: Procurar por palavras-chave específicas
            const cinturaPatterns = [
                /cintura[^:]*:\s*(\d+(?:\.\d+)?)/i,
                /cintura[^:]*\s+(\d+(?:\.\d+)?)/i,
                /waist[^:]*:\s*(\d+(?:\.\d+)?)/i
            ];
            
            const quadrilPatterns = [
                /quadril[^:]*:\s*(\d+(?:\.\d+)?)/i,
                /quadril[^:]*\s+(\d+(?:\.\d+)?)/i,
                /glúteo[^:]*:\s*(\d+(?:\.\d+)?)/i,
                /hip[^:]*:\s*(\d+(?:\.\d+)?)/i
            ];
            
            // Tentar encontrar cintura
            for (const pattern of cinturaPatterns) {
                const match = textStr.match(pattern);
                if (match) {
                    const value = parseFloat(match[1]);
                    if (isValidMeasurement(value, 'cintura')) {
                        cintura = value;
                        break;
                    }
                }
            }
            
            // Tentar encontrar quadril
            for (const pattern of quadrilPatterns) {
                const match = textStr.match(pattern);
                if (match) {
                    const value = parseFloat(match[1]);
                    if (isValidMeasurement(value, 'quadril')) {
                        quadril = value;
                        break;
                    }
                }
            }
            
            // Se encontrou com palavras-chave, retornar
            if (cintura !== null || quadril !== null) {
                return { cintura, quadril };
            }
            
            // Fallback para textos simples
            const textLower = textStr.toLowerCase();
            const numbers = textLower.match(/\d+(?:\.\d+)?/g);
            
            if (!numbers || numbers.length < 2) {
                if (numbers && numbers.length === 1) {
                    const num = parseFloat(numbers[0]);
                    if (textLower.includes('quadril') || textLower.includes('hip') || textLower.includes('glúteo')) {
                        return { cintura: null, quadril: isValidMeasurement(num, 'quadril') ? num : null };
                    } else if (textLower.includes('cintura') || textLower.includes('waist')) {
                        return { cintura: isValidMeasurement(num, 'cintura') ? num : null, quadril: null };
                    }
                }
                return { cintura: null, quadril: null };
            }
            
            const nums = numbers.map(n => parseFloat(n));
            const validNums = nums.filter(n => n >= 40 && n <= 200);
            
            if (validNums.length >= 2) {
                const consecutivePattern = textLower.match(/(\d+(?:\.\d+)?)\s*(?:cm|e)?\s*(\d+(?:\.\d+)?)/);
                
                if (consecutivePattern) {
                    const num1 = parseFloat(consecutivePattern[1]);
                    const num2 = parseFloat(consecutivePattern[2]);
                    
                    if (num1 >= 40 && num1 <= 200 && num2 >= 40 && num2 <= 200) {
                        if (num1 >= 50 && num1 <= 100 && num2 >= 80 && num2 <= 150 && num2 > num1) {
                            cintura = num1;
                            quadril = num2;
                        } else if (num2 >= 50 && num2 <= 100 && num1 >= 80 && num1 <= 150 && num1 > num2) {
                            cintura = num2;
                            quadril = num1;
                        } else {
                            if (num1 < num2) {
                                cintura = isValidMeasurement(num1, 'cintura') ? num1 : null;
                                quadril = isValidMeasurement(num2, 'quadril') ? num2 : null;
                            } else {
                                cintura = isValidMeasurement(num2, 'cintura') ? num2 : null;
                                quadril = isValidMeasurement(num1, 'quadril') ? num1 : null;
                            }
                        }
                        
                        return { cintura, quadril };
                    }
                }
                
                const [num1, num2] = validNums;
                
                if (num1 < num2) {
                    cintura = isValidMeasurement(num1, 'cintura') ? num1 : null;
                    quadril = isValidMeasurement(num2, 'quadril') ? num2 : null;
                } else {
                    cintura = isValidMeasurement(num2, 'cintura') ? num2 : null;
                    quadril = isValidMeasurement(num1, 'quadril') ? num1 : null;
                }
            }
            
            return { cintura, quadril };
        }

        // Casos de teste
        const testCases = [
            "cintura 63 quadril 97",
            "63 97",
            "97 63",
            "63cm 97cm",
            "21cm 97cm", // Caso problemático
            "78 97", // Outro caso
            "cintura: 63, quadril: 97",
            "63 e 97",
            "medidas: 63 97",
            // Caso real da paciente
            "*AVALIAÇÃO CORPORAL MENSAL - 21/11/2025**Deltoide:* 97*Antebraço Direito:* 23*Antebraço Esquerdo:* 23*Biceps Contraido Direito:* 27*Biceps Contraido Esquerdo:* 27*Peitoral Maior:* 78*Abdominal(umbigo):* 70*Cintura(abaixo ultima costela):* 63*Quadril (Glúteo Maior):* 97*Coxa Esquerda:* 54*Coxa Direita:* 54*Panturrilha Direita:* 31*Panturrilha Esquerda:* 32"
        ];

        const resultsDiv = document.getElementById('results');
        
        testCases.forEach(testCase => {
            const result = extractMeasurements(testCase);
            const div = document.createElement('div');
            div.innerHTML = `
                <p><strong>Texto:</strong> "${testCase}"</p>
                <p><strong>Resultado:</strong> Cintura: ${result.cintura || 'N/A'}cm, Quadril: ${result.quadril || 'N/A'}cm</p>
                <hr>
            `;
            resultsDiv.appendChild(div);
        });
    </script>
</body>
</html>