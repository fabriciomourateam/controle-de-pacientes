<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Extra√ß√£o de Medidas - Texto Complexo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1e293b;
            color: #e2e8f0;
        }
        .test-case {
            background-color: #334155;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }
        .result {
            background-color: #0f172a;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .success { border-left-color: #10b981; }
        .warning { border-left-color: #f59e0b; }
        .error { border-left-color: #ef4444; }
    </style>
</head>
<body>
    <h1>üß™ Teste de Extra√ß√£o de Medidas - Texto Complexo</h1>
    
    <div id="results"></div>

    <script>
        // Copiar a fun√ß√£o extractMeasurements aqui
        function isValidMeasurement(value, type) {
            if (type === 'cintura') {
                return value >= 50 && value <= 120;
            } else {
                return value >= 70 && value <= 150;
            }
        }

        function extractMeasurements(text) {
            if (!text) return { cintura: null, quadril: null };
            
            const textStr = text.toString();
            
            let cintura = null;
            let quadril = null;
            
            // Padr√£o 1: Procurar por palavras-chave espec√≠ficas com mais precis√£o
            const cinturaPatterns = [
                /cintura[^:]*:\*?\s*(\d+(?:\.\d+)?)/i,
                /cintura[^:]*\s+(\d+(?:\.\d+)?)/i,
                /waist[^:]*:\*?\s*(\d+(?:\.\d+)?)/i,
                /abaixo.*costela[^:]*:\*?\s*(\d+(?:\.\d+)?)/i
            ];
            
            const quadrilPatterns = [
                /quadril[^:]*:\*?\s*(\d+(?:\.\d+)?)/i,
                /quadril[^:]*\s+(\d+(?:\.\d+)?)/i,
                /gl√∫teo[^:]*:\*?\s*(\d+(?:\.\d+)?)/i,
                /hip[^:]*:\*?\s*(\d+(?:\.\d+)?)/i,
                /gl√∫teo\s+maior[^:]*:\*?\s*(\d+(?:\.\d+)?)/i
            ];
            
            // Tentar encontrar cintura
            for (const pattern of cinturaPatterns) {
                const match = textStr.match(pattern);
                if (match) {
                    const value = parseFloat(match[1]);
                    if (isValidMeasurement(value, 'cintura')) {
                        cintura = value;
                        break;
                    }
                }
            }
            
            // Tentar encontrar quadril
            for (const pattern of quadrilPatterns) {
                const match = textStr.match(pattern);
                if (match) {
                    const value = parseFloat(match[1]);
                    if (isValidMeasurement(value, 'quadril')) {
                        quadril = value;
                        break;
                    }
                }
            }
            
            // Se encontrou ambos com palavras-chave, retornar
            if (cintura !== null || quadril !== null) {
                return { cintura, quadril };
            }
            
            // Padr√£o 2: Fallback para textos simples
            const textLower = textStr.toLowerCase();
            const numbers = textLower.match(/\d+(?:\.\d+)?/g);
            
            if (!numbers || numbers.length < 2) {
                if (numbers && numbers.length === 1) {
                    const num = parseFloat(numbers[0]);
                    if (textLower.includes('quadril') || textLower.includes('hip') || textLower.includes('gl√∫teo')) {
                        return { cintura: null, quadril: isValidMeasurement(num, 'quadril') ? num : null };
                    } else if (textLower.includes('cintura') || textLower.includes('waist')) {
                        return { cintura: isValidMeasurement(num, 'cintura') ? num : null, quadril: null };
                    }
                }
                return { cintura: null, quadril: null };
            }
            
            const nums = numbers.map(n => parseFloat(n));
            const validNums = nums.filter(n => n >= 40 && n <= 200);
            
            if (validNums.length >= 2) {
                const consecutivePattern = textLower.match(/(\d+(?:\.\d+)?)\s*(?:cm|e)?\s*(\d+(?:\.\d+)?)/);
                
                if (consecutivePattern) {
                    const num1 = parseFloat(consecutivePattern[1]);
                    const num2 = parseFloat(consecutivePattern[2]);
                    
                    if (num1 >= 40 && num1 <= 200 && num2 >= 40 && num2 <= 200) {
                        if (num1 >= 50 && num1 <= 100 && num2 >= 80 && num2 <= 150 && num2 > num1) {
                            cintura = num1;
                            quadril = num2;
                        } else if (num2 >= 50 && num2 <= 100 && num1 >= 80 && num1 <= 150 && num1 > num2) {
                            cintura = num2;
                            quadril = num1;
                        } else {
                            if (num1 < num2) {
                                cintura = isValidMeasurement(num1, 'cintura') ? num1 : null;
                                quadril = isValidMeasurement(num2, 'quadril') ? num2 : null;
                            } else {
                                cintura = isValidMeasurement(num2, 'cintura') ? num2 : null;
                                quadril = isValidMeasurement(num1, 'quadril') ? num1 : null;
                            }
                        }
                        
                        return { cintura, quadril };
                    }
                }
                
                const [num1, num2] = validNums;
                
                if (num1 < num2) {
                    cintura = isValidMeasurement(num1, 'cintura') ? num1 : null;
                    quadril = isValidMeasurement(num2, 'quadril') ? num2 : null;
                } else {
                    cintura = isValidMeasurement(num2, 'cintura') ? num2 : null;
                    quadril = isValidMeasurement(num1, 'quadril') ? num1 : null;
                }
            }
            
            return { cintura, quadril };
        }

        // Casos de teste
        const testCases = [
            {
                name: "Texto complexo do usu√°rio",
                input: "*AVALIA√á√ÉO CORPORAL MENSAL - 21/11/2025**Deltoide:* 97*Antebra√ßo Direito:* 23*Antebra√ßo Esquerdo:* 23*Biceps Contraido Direito:* 27*Biceps Contraido Esquerdo:* 27*Peitoral Maior:* 78*Abdominal(umbigo):* 70*Cintura(abaixo ultima costela):* 63*Quadril (Gl√∫teo Maior):* 97*Coxa Esquerda:* 54*Coxa Direita:* 54*Panturrilha Direita:* 31*Panturrilha Esquerda:* 32",
                expected: { cintura: 63, quadril: 97 }
            },
            {
                name: "Texto simples - cintura 63 quadril 97",
                input: "cintura 63 quadril 97",
                expected: { cintura: 63, quadril: 97 }
            },
            {
                name: "Texto simples - 63 97",
                input: "63 97",
                expected: { cintura: 63, quadril: 97 }
            },
            {
                name: "Texto invertido - quadril 97 cintura 63",
                input: "quadril 97 cintura 63",
                expected: { cintura: 63, quadril: 97 }
            },
            {
                name: "Texto invertido - 97 63",
                input: "97 63",
                expected: { cintura: 63, quadril: 97 }
            },
            {
                name: "S√≥ cintura",
                input: "cintura: 65",
                expected: { cintura: 65, quadril: null }
            },
            {
                name: "S√≥ quadril",
                input: "quadril: 95",
                expected: { cintura: null, quadril: 95 }
            },
            {
                name: "Valores inv√°lidos",
                input: "cintura: 21 quadril: 200",
                expected: { cintura: null, quadril: null }
            }
        ];

        function runTests() {
            const resultsDiv = document.getElementById('results');
            let passedTests = 0;
            
            testCases.forEach((testCase, index) => {
                const result = extractMeasurements(testCase.input);
                const passed = JSON.stringify(result) === JSON.stringify(testCase.expected);
                
                if (passed) passedTests++;
                
                const testDiv = document.createElement('div');
                testDiv.className = `test-case ${passed ? 'success' : 'error'}`;
                
                testDiv.innerHTML = `
                    <h3>Teste ${index + 1}: ${testCase.name}</h3>
                    <p><strong>Input:</strong> "${testCase.input}"</p>
                    <div class="result">
                        <strong>Esperado:</strong> ${JSON.stringify(testCase.expected)}<br>
                        <strong>Resultado:</strong> ${JSON.stringify(result)}<br>
                        <strong>Status:</strong> ${passed ? '‚úÖ PASSOU' : '‚ùå FALHOU'}
                    </div>
                `;
                
                resultsDiv.appendChild(testDiv);
            });
            
            // Resumo
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-case ${passedTests === testCases.length ? 'success' : 'warning'}`;
            summaryDiv.innerHTML = `
                <h3>üìä Resumo dos Testes</h3>
                <p><strong>Testes Passaram:</strong> ${passedTests}/${testCases.length}</p>
                <p><strong>Taxa de Sucesso:</strong> ${Math.round((passedTests / testCases.length) * 100)}%</p>
            `;
            
            resultsDiv.appendChild(summaryDiv);
        }

        // Executar testes quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>